pr_advgyro_gyro_last = 0
pr_advgyro_gyro_angle = 0
lv_angle_1 = 0
lv_angle_2 = 0
lv_angle_3 = 0
lv_wrapped_angle_3 = 0
gv_angle = 0
gv_wrapped_angle = 0
lv_angle_2 = 0
gv_enc = 0
Sensor.SetMode ( 2 , 0 )
lv_angle_1 = 0
m_advgyro_resetport2_1 ()
LCD.Clear ()
While 1 = 1
m_advgyro_writeport2_1 ()
gv_angle = lv_angle_2
gv_enc = MotorA.GetTacho ()
lv_angle_3 = 100
m_toolbox_anglewrap_2 ()
gv_wrapped_angle = lv_wrapped_angle_3
LCD.Text ( 1 , 10 , 10 , 2 , gv_angle )
LCD.Text ( 1 , 10 , 50 , 2 , gv_enc )
Program.Delay ( 500 )
LCD.Clear ()
EndWhile
Sub m_advgyro_resetport2_1
lv_value_1 = Sensor2.Raw1 ()
pr_advgyro_gyro_last = lv_value_1 - lv_angle_1
EndSub
Sub m_advgyro_writeport2_1
lv_value_2 = Sensor2.Raw1 ()
lv_unwrapped_angle_2 = lv_value_2 - pr_advgyro_gyro_last
lv_angle_3 = lv_unwrapped_angle_2
m_toolbox_anglewrap_2 ()
lv_angle_2 = lv_wrapped_angle_3
pr_advgyro_gyro_angle = lv_angle_2
EndSub
Sub m_toolbox_anglewrap_2
If lv_angle_3 < 0 Then
lv_a_3 = - 180
Else
lv_a_3 = 180
EndIf
lv_wrapped_angle_3 = Math.Remainder ( ( lv_angle_3 + lv_a_3 ) , 360 ) - lv_a_3
EndSub
