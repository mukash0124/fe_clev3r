pr_advgyro_gyro_last = 0
pr_advgyro_gyro_angle = 0
lv_port_1 = 0
lv_result_1 = 0
lv_port_2 = 0
lv_angle_3 = 0
lv_angle_4 = 0
lv_port_6 = 0
lv_x_6 = 0
lv_y_6 = 0
lv_signature_6 = 0
lv_angle_5 = 0
lv_wrapped_angle_5 = 0
gv_result = 0
gv_gyroangle = 0
gv_pixyx = 0
gv_pixyy = 0
gv_signature = 0
lv_angle_4 = 0
gv_uart = 0
gv_i2c = 0
Sensor.SetMode ( 2 , 0 )
lv_port_1 = 2
m_advgyro_checkreset_2 ()
gv_result = lv_result_1
While gv_result = 0
lv_port_2 = 2
m_advgyro_hardreset_1 ()
lv_port_1 = 2
m_advgyro_checkreset_2 ()
gv_result = lv_result_1
EndWhile
lv_angle_3 = 0
m_advgyro_resetport2_1 ()
gv_uart = 0
gv_i2c = 0
Thread.Run = f_uart_0
Thread.Run = f_i2c_0
While 1 = 1
LCD.Text ( 1 , 10 , 10 , 2 , gv_uart )
LCD.Text ( 1 , 10 , 40 , 2 , gv_i2c )
Program.Delay ( 1 )
LCD.Clear ()
EndWhile
Sub f_uart_0
While 1 = 1
m_advgyro_writeport2_1 ()
gv_gyroangle = lv_angle_4
gv_uart = gv_uart + 1
EndWhile
EndSub
Sub f_i2c_0
gv_i2cready = 1
While 1 = 1
lv_port_6 = 1
m_advpixy_getlargest_4 ()
gv_pixyx = lv_x_6
gv_pixyy = lv_y_6
gv_signature = lv_signature_6
gv_i2c = gv_i2c + 1
EndWhile
EndSub
Sub m_advgyro_checkreset_2
Sensor.SetMode ( lv_port_1 , 0 )
Sensor.ReadRawValue ( lv_port_1 , 0 )
Program.Delay ( 600 )
If Sensor.ReadRawValue ( lv_port_1 , 0 ) <> 0 Then
lv_result_1 = 0
Speaker.Note ( 100 , "C5" , 100 )
Speaker.Wait ()
Speaker.Note ( 100 , "C5" , 100 )
Speaker.Wait ()
Speaker.Note ( 100 , "C5" , 100 )
Speaker.Wait ()
Else
lv_result_1 = 1
EndIf
EndSub
Sub m_advgyro_hardreset_1
Sensor.SetMode ( lv_port_2 , 4 )
Program.Delay ( 550 )
Sensor.SetMode ( lv_port_2 , 0 )
EndSub
Sub m_advgyro_resetport2_1
lv_value_3 = Sensor2.Raw1 ()
pr_advgyro_gyro_last = lv_value_3 - lv_angle_3
EndSub
Sub m_advgyro_writeport2_1
lv_value_4 = Sensor2.Raw1 ()
lv_unwrapped_angle_4 = lv_value_4 - pr_advgyro_gyro_last
lv_angle_5 = lv_unwrapped_angle_4
m_toolbox_anglewrap_2 ()
lv_angle_4 = lv_wrapped_angle_5
pr_advgyro_gyro_angle = lv_angle_4
EndSub
Sub m_toolbox_anglewrap_2
If lv_angle_5 < 0 Then
lv_a_5 = - 180
Else
lv_a_5 = 180
EndIf
lv_wrapped_angle_5 = Math.Remainder ( ( lv_angle_5 + lv_a_5 ) , 360 ) - lv_a_5
EndSub
Sub m_advpixy_getlargest_4
lv_values_6 = Sensor.ReadI2CRegisters ( lv_port_6 , 1 , 80 , 6 )
lv_sig1_6 = lv_values_6 [ 0 ]
lv_sig2_6 = lv_values_6 [ 1 ]
lv_signature_6 = ( lv_sig1_6 + lv_sig2_6 * 256 ) - 8 * Math.Floor ( ( lv_sig1_6 + lv_sig2_6 * 256 ) / 8 )
lv_x_6 = lv_values_6 [ 2 ] - 128
lv_y_6 = lv_values_6 [ 3 ]
EndSub
